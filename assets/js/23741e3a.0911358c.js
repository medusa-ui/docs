"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[93],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},y=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),y=o,f=p["".concat(s,".").concat(y)]||p[y]||d[y]||a;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=y;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}y.displayName="MDXCreateElement"},4420:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={sidebar_position:5},i="Security",l={unversionedId:"internals/security",id:"internals/security",title:"Security",description:"As a micro frontend framework that mainly relies on Spring Security for its security functionality,",source:"@site/docs/internals/security.md",sourceDirName:"internals",slug:"/internals/security",permalink:"/documentation/docs/internals/security",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Hydra flow",permalink:"/documentation/docs/internals/hydra-flow"},next:{title:"TODO",permalink:"/documentation/docs/internals/todo"}},s={},u=[{value:"Setup",id:"setup",level:2},{value:"Role mapping",id:"role-mapping",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"security"},"Security"),(0,o.kt)("p",null,"As a micro frontend framework that mainly relies on Spring Security for its security functionality,\nyou can deploy multiple Medusa instances internally and have Hydra be the gateway. "),(0,o.kt)("p",null,"As a gateway it will combine all micro frontends into a single ui experience.\nBy doing so, you only have to log in once into Hydra and you will be logged into whatever Medusa instance you hit."),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("p",null,"Medusa has some preconfigured security features that can be easily set up by using a default base of security configuration."),(0,o.kt)("p",null,"To set up security rules on the Medusa level using a default base, you can use something like the following code snippet:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'@Bean\npublic SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) {\n    return MedusaSecurity.defaultSecurity(http)\n        .authorizeExchange()\n        .pathMatchers("/secure/**").authenticated()\n        .pathMatchers("/secure/special-role/**").hasRole("SPECIAL")\n        .anyExchange().permitAll()\n        .and().build();\n}\n')),(0,o.kt)("p",null,"This will forward you to a form login if you hit an authenticated-only endpoint."),(0,o.kt)("p",null,"If Hydra is running and connected, and you access said endpoint via Hydra, the forward to login will be to Hydra's login form. "),(0,o.kt)("p",null,"This login form can be the default provided one, or you can add a custom one as 'templates/login.html' and it will use that one instead. It uses plain spring security. "),(0,o.kt)("p",null,"Once logged into the Hydra login form, a JWT token cookie will be set. This token can be interpreted by any Medusa instance you're connected to. It will automatically log you in."),(0,o.kt)("h2",{id:"role-mapping"},"Role mapping"),(0,o.kt)("p",null,"By default, any roles associated with the users in Hydra are also applied to your login session in Medusa. This is a 1-to-1 mapping."),(0,o.kt)("p",null,"So if you have a Hydra user with the role 'USER', you can use the 'USER' role in Medusa without any further work. The role will be added to the JWT token and applied upon login. If the roles change, you will need a new JWT token."),(0,o.kt)("p",null,"However, since these are a collection of microservices, you could have roles that don't match between services. For this, there is the concept of role mapping available."),(0,o.kt)("p",null,"In hydra, you add the following kind of configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#Example of mapping a role MANAGER to ADMIN\nmedusa.hydra.roles.MANAGER.mapped_to=ADMIN\nmedusa.hydra.roles.MANAGER.service=MyService,MyOtherService\n")),(0,o.kt)("p",null,"This will make it so that a user known in Hydra as the role 'MANAGER', will be known in the services MyService and MyOtherService as 'ADMIN'."),(0,o.kt)("p",null,"The .service is a comma seperated list, but can also be a regex pattern. For example, you could use '.*' to have a mapping apply to every service."))}d.isMDXComponent=!0}}]);