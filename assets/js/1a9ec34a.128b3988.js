"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[702],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),f=a,m=p["".concat(s,".").concat(f)]||p[f]||d[f]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3954:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={sidebar_position:4},s="Hydra flow",c={unversionedId:"internals/hydra-flow",id:"internals/hydra-flow",title:"Hydra flow",description:"Goal",source:"@site/docs/internals/hydra-flow.md",sourceDirName:"internals",slug:"/internals/hydra-flow",permalink:"/documentation/docs/internals/hydra-flow",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Components",permalink:"/documentation/docs/internals/components"},next:{title:"TODO",permalink:"/documentation/docs/internals/todo"}},u={},d=[{value:"Goal",id:"goal",level:2},{value:"Flow",id:"flow",level:2},{value:"Fragments",id:"fragments",level:2}],p={toc:d};function f(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"hydra-flow"},"Hydra flow"),(0,o.kt)("h2",{id:"goal"},"Goal"),(0,o.kt)("p",null,"The goal of Hydra is to provide coupling with Medusa in order to allow for micro-frontends. What we mean by that is the ability to develop and deploy frontends as independent services and then combine them into a singular user experience for the user."),(0,o.kt)("p",null,"Some potential usecases:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Content can be made dynamically available based on the availability of a service. For example, if the ordering system is down, the informational part of the site could still keep working."),(0,o.kt)("li",{parentName:"ul"},"The user only has to log in once, even if different services require different logins."),(0,o.kt)("li",{parentName:"ul"},"New versions of features can be tested by only conditionally exposing it to users via weights (10% of users see new feature, 90% as-is)"),(0,o.kt)("li",{parentName:"ul"},"Etc.")),(0,o.kt)("h2",{id:"flow"},"Flow"),(0,o.kt)("p",null,"The way the flow works is mostly based on Spring Cloud Gateway. We derive the available services at run-time due to RSocket connections. "),(0,o.kt)("p",null,"So in other words, every Medusa app deployed points to a Hydra cluster. This starts a heartbeat RSocket channel."),(0,o.kt)("p",null,"The channel's basic connection / disconnect works as a way to know which services are available to the Hydra cluster. We spread the information to the cluster by simply storing it in memory for singular instances and Redis for clustered deploys."),(0,o.kt)("p",null,"As the channel is active, the two-way connection can be used to pass along fragment data."),(0,o.kt)("h2",{id:"fragments"},"Fragments"),(0,o.kt)("p",null,"Fragments are the core of combined page micro-frontends. The idea is to have a system that can reliably combine parts of pages from different microservices (aka fragments) into a core page."),(0,o.kt)("p",null,"So the routing works as normal for the core page, but during rendering it will find fragment tags and resolve them by asking Hydra for its info. If no such info is available, it shows the fallback."),(0,o.kt)("p",null,"A core page with a fragment tag would look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>Title</title>\n</head>\n<body>\n\n<h1>Hello, this is a core page</h1>\n\n<m:fragment service="orderService" ref="checkout" exports="postalZipCode, addressLine2 as address" imports="dob, countryOrigin as country">\n    Fallback info\n</m:fragment>\n\n</body>\n</html>\n')),(0,o.kt)("p",null,"Fragments must be executed on their respective servers and HTML is returned to the root server where it is 'fragmented'. The servers connect to Hydra anyway, so Hydra can use that connection to ask to render certain HTML."),(0,o.kt)("p",null,"This is illustrated with exports and imports to be as expansive as possible. By default, fragments and their attributes are a fully closed system. In other words, fragments do not interact with the core page or other fragments by default."),(0,o.kt)("p",null,"If such coordination is required, it should be explicitly pointed out."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"An export means that an Attribute with matching keyName will be made available to the core page. In case of a conflict, an exception will be thrown at compile-time. Developers can specify an alias via 'as my-alias' to specify a non-conflicting name."),(0,o.kt)("li",{parentName:"ul"},"An import means that an Attribute available to the core page will be made available to the fragment. These can also be aliased in case of conflict."),(0,o.kt)("li",{parentName:"ul"},"Service / Ref define which Medusa UI app (service) and which page fragment (ref) get used.")))}f.isMDXComponent=!0}}]);