"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4652],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(n),h=a,m=p["".concat(c,".").concat(h)]||p[h]||u[h]||o;return n?r.createElement(m,i(i({ref:t},d),{},{components:n})):r.createElement(m,i({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6125:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:2},c="Internal flow of rendering",l={unversionedId:"internals/medusa-flow",id:"internals/medusa-flow",title:"Internal flow of rendering",description:"As part of Medusa v1.0.0, these are the steps the code takes to render a page. Relevant to note is that at this point, at-startup initialization has completed.",source:"@site/docs/internals/medusa-flow.md",sourceDirName:"internals",slug:"/internals/medusa-flow",permalink:"/documentation/docs/internals/medusa-flow",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"At startup initialization",permalink:"/documentation/docs/internals/at-startup-initialization"},next:{title:"Components",permalink:"/documentation/docs/internals/components"}},d={},u=[{value:"Initial render",id:"initial-render",level:2},{value:"Subsequence actions",id:"subsequence-actions",level:2},{value:"Server-to-client actions",id:"server-to-client-actions",level:2}],p={toc:u};function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"internal-flow-of-rendering"},"Internal flow of rendering"),(0,o.kt)("p",null,"As part of Medusa v1.0.0, these are the steps the code takes to render a page. Relevant to note is that at this point, ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/at-startup-initialization"},"at-startup initialization")," has completed. "),(0,o.kt)("p",null,"This does not account for Hydra, which is described in the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/hydra-flow"},"Hydra flow"),". and describes its flow at more of an architectural high-level point. "),(0,o.kt)("h2",{id:"initial-render"},"Initial render"),(0,o.kt)("p",null,"We start with a new request being made in the browser to our server. This request is picked up by the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#req-handler"},"request handler"),"."),(0,o.kt)("p",null,"Here, we find the relevant controller. Using the controller, we find the combination of referenced raw Thymeleaf HTML and initial parameters. This also starts a ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#session"},"session"),"."),(0,o.kt)("p",null,"Said combination is used to ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#renderer"},"render")," the page. Within the page, we establish an RSocket channel. "),(0,o.kt)("p",null,"From that point on, any interaction with the page is done through the RSocket channel - at least until a page change, which counts as a new request.  "),(0,o.kt)("h2",{id:"subsequence-actions"},"Subsequence actions"),(0,o.kt)("p",null,"As an action happens, we want to trigger a controller method server-side. Each action triggered through a Medusa tag,\nwill be triggering a Javascript function which builds up an event and sends it through the RSocket channel."),(0,o.kt)("p",null,"The event is retrieved by the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#action-handler"},"Action Handler")," component.\nThis component retrieves the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#session"},"session"),", which can tell us which template was rendered."),(0,o.kt)("p",null,"Using this combination of information we can trigger the controller method and retrieve a set of ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#dom-changes"},"DOMChanges"),". "),(0,o.kt)("p",null,"This set of dom changes can be merged with the last used attributes from the session, to then trigger a ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#renderer"},"re-render")," of the template."),(0,o.kt)("p",null,"This results in a new HTML. "),(0,o.kt)("p",null,"We then route this HTML though the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#diff-engine"},"Diff Engine"),", together with the last ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#renderer"},"rendered")," HTML from the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#session"},"session"),"."),(0,o.kt)("p",null,"We then send the diffs back through the RSocket Channel. These diffs contain the changed HTML, the action (add, delete or edit a node) and the relevant xpath to the changing DOM node."),(0,o.kt)("p",null,"In the JS we then apply the diff in the browser via ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/patrick-steele-idem/morphdom"},"morphdom"),". "),(0,o.kt)("h2",{id:"server-to-client-actions"},"Server-to-client actions"),(0,o.kt)("p",null,"Communication in Medusa is bidirectional, meaning changes can happen not only due to actions from the browser, but also from the server."),(0,o.kt)("p",null,"Key to this is access to the ",(0,o.kt)("a",{parentName:"p",href:"/documentation/docs/internals/components#session"},"session")," a user has. Each session can get tags assigned to it."),(0,o.kt)("p",null,"Developers can also add tags to sessions programmatically. "),(0,o.kt)("p",null,"Some such tags are also automatically added to the sessions, like the current page they are on and the kind of roles they have."),(0,o.kt)("p",null,"With the tags, these sessions can then be queried. With a list of sessions, these can then be used to send events."))}h.isMDXComponent=!0}}]);